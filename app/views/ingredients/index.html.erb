<div class="dashboard-container">
  <!-- Sidebar Navigation -->
  <div class="sidebar" id="sidebar">
    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle Sidebar" onclick="toggleSidebar()">
      <svg class="toggle-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect width="18" height="18" x="3" y="3" rx="2"/>
        <path d="M9 3v18"/>
        <path d="m14 9 3 3-3 3"/>
      </svg>
    </button>
    
    <div class="sidebar-header">
      <div class="logo-container">
        <div class="logo-icon">üçΩÔ∏è</div>
        <span class="logo-text">SeatSync</span>
      </div>
    </div>
    
    <nav class="sidebar-nav">
      <%= link_to dashboard_path, class: 'nav-item' do %>
        <span class="nav-content"><span class="nav-text">Restaurant Analytics</span></span>
        <div class="nav-marquee"><div class="marquee-inner"><span>Restaurant Analytics</span><span>Restaurant Analytics</span></div></div>
      <% end %>
      
      <%= link_to new_receipt_path, class: 'nav-item' do %>
        <span class="nav-content"><span class="nav-text">Upload Images</span></span>
        <div class="nav-marquee"><div class="marquee-inner"><span>Upload Images</span><span>Upload Images</span></div></div>
      <% end %>
      
      <%= link_to ingredients_path, class: 'nav-item active' do %>
        <span class="nav-content"><span class="nav-text">Ingredients Dashboard</span></span>
        <div class="nav-marquee"><div class="marquee-inner"><span>Ingredients Dashboard</span><span>Ingredients Dashboard</span></div></div>
      <% end %>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="main-content" id="mainContent">
    <div class="dashboard-header">
      <div>
        <h1 class="dashboard-title">Ingredients Dashboard</h1>
        <p class="dashboard-subtitle">Track ingredient usage across all menu items</p>
      </div>
    </div>

    <% if @ingredient_usage.any? %>
      <div class="chart-card" style="margin-bottom: 2rem;">
        <div class="chart-header">
          <h3 class="chart-title">Ingredient Usage This Month</h3>
          <p class="chart-subtitle">Total consumption from <%= Date.today.beginning_of_month.strftime('%B %d') %> - <%= Date.today.strftime('%B %d, %Y') %></p>
        </div>

        <div class="ingredient-table" style="padding: 1.5rem;">
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="border-bottom: 2px solid #334155;">
                <th style="padding: 12px; text-align: left; color: #94a3b8; font-size: 12px; text-transform: uppercase;">Ingredient</th>
                <th style="padding: 12px; text-align: right; color: #94a3b8; font-size: 12px; text-transform: uppercase;">Unit</th>
                <th style="padding: 12px; text-align: right; color: #94a3b8; font-size: 12px; text-transform: uppercase;">This Month</th>
                <th style="padding: 12px; text-align: right; color: #94a3b8; font-size: 12px; text-transform: uppercase;">Last Month</th>
                <th style="padding: 12px; text-align: right; color: #94a3b8; font-size: 12px; text-transform: uppercase;">Change</th>
              </tr>
            </thead>
            <tbody>
              <% @ingredient_usage.sort_by { |_, amount| -amount }.each do |ingredient_name, amount| %>
                <% ingredient = Ingredient.find_by(name: ingredient_name) %>
                <% last_month_amount = @last_month_usage[ingredient_name] || 0 %>
                <% change_percent = last_month_amount > 0 ? ((amount - last_month_amount) / last_month_amount * 100).round(1) : 0 %>
                <tr style="border-bottom: 1px solid #1e293b;">
                  <td style="padding: 16px; color: #e2e8f0; font-weight: 500;"><%= ingredient_name %></td>
                  <td style="padding: 16px; text-align: right; color: #94a3b8;"><%= ingredient&.unit || 'lbs' %></td>
                  <td style="padding: 16px; text-align: right; color: #10b981; font-weight: 600;"><%= number_with_precision(amount, precision: 2) %></td>
                  <td style="padding: 16px; text-align: right; color: #64748b;"><%= number_with_precision(last_month_amount, precision: 2) %></td>
                  <td style="padding: 16px; text-align: right;">
                    <% if change_percent > 0 %>
                      <span style="color: #10b981;">+<%= change_percent %>%</span>
                    <% elsif change_percent < 0 %>
                      <span style="color: #ef4444;"><%= change_percent %>%</span>
                    <% else %>
                      <span style="color: #64748b;">-</span>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>

      <div class="metrics-row" style="gap: 1.5rem;">
        <div class="metric-card">
          <div class="metric-content">
            <div class="metric-label">Total Ingredients</div>
            <div class="metric-value-container">
              <span class="metric-value"><%= @ingredients.count %></span>
              <span class="metric-unit">types</span>
            </div>
          </div>
          <div class="metric-icon accent-emerald">üì¶</div>
        </div>

        <div class="metric-card">
          <div class="metric-content">
            <div class="metric-label">Top Ingredient</div>
            <div class="metric-value-container">
              <span class="metric-value" style="font-size: 1.25rem;"><%= @ingredient_usage.max_by { |_, v| v }&.first || 'N/A' %></span>
            </div>
          </div>
          <div class="metric-icon accent-emerald">ü•á</div>
        </div>

        <div class="metric-card">
          <div class="metric-content">
            <div class="metric-label">Receipts This Month</div>
            <div class="metric-value-container">
              <span class="metric-value"><%= Receipt.where(receipt_date: Date.today.beginning_of_month..Date.today).count %></span>
              <span class="metric-unit">orders</span>
            </div>
          </div>
          <div class="metric-icon accent-emerald">üßæ</div>
        </div>
      </div>
    <% else %>
      <div class="chart-card" style="text-align: center; padding: 4rem 2rem;">
        <h3 style="color: #e2e8f0; font-size: 1.5rem; margin-bottom: 1rem;">No Data Available</h3>
        <p style="color: #94a3b8; margin-bottom: 2rem;">Upload receipts to start tracking ingredient usage</p>
        <%= link_to 'Upload Receipt', new_receipt_path, class: 'btn btn-primary', style: 'display: inline-block; padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; text-decoration: none; border-radius: 8px; font-weight: 600;' %>
      </div>
    <% end %>
  </div>
</div>

<script>
function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('collapsed');
  document.getElementById('mainContent').classList.toggle('expanded');
}
</script>
